# Story 1.5: Camunda BPMN Workflow Design and Deployment

Status: Draft

## Story

**As a** system architect,  
**I want** a comprehensive BPMN workflow deployed to Camunda that orchestrates the loan lifecycle,  
**so that** approval routing, compliance gates, and agreement generation are process-driven rather than code-driven.

## Acceptance Criteria

1. `loan-origination-process.bpmn` designed with sequence: Start → KYC Gate → Application → Assessment → Approval Routing → Agreement → Disbursement → Active
2. Exclusive gateway for approval routing with conditions: Amount ≤50K AND Grade A/B → Credit Analyst; Amount >50K OR Grade C → Head of Credit; Amount >250K OR Grade D/F → Dual Control (Head + CEO)
3. Human tasks defined with candidate groups: `credit-analysts`, `head-of-credit`, `ceo`, `finance-officers`
4. Service tasks defined with job types: `verify-kyc`, `request-credit-assessment`, `generate-agreement`, `execute-disbursement`
5. `BpmnDeploymentService` implemented as IHostedService to deploy BPMN on startup, log deployment key
6. WorkflowService.StartLoanOriginationWorkflowAsync creates process instance with variables: `{applicationId, clientId, loanAmount, riskGrade}`
7. BPMN validated using Camunda Modeler, no validation errors
8. Unit test verifies BpmnDeploymentService reads BPMN file, calls Zeebe deploy API

## Integration Verification

- **IV1**: Deploy service with BPMN - verify startup logs show successful deployment with workflow key
- **IV2**: Start workflow instance via WorkflowService - verify Camunda Operate shows active instance
- **IV3**: Existing CRUD APIs continue working (workflow disabled via feature flag initially)

## Dev Notes

### Previous Story Insights
- Story 1.1 completed database schema with versioning columns (WorkflowInstanceId field already exists in LoanApplication model)
- Story 1.2 implemented LoanVersioningService with loan number generation
- Story 1.3 integrated Vault for product configurations
- Story 1.4 integrated Client Management Service for KYC verification
- Zeebe client already configured in Program.cs [Source: brownfield-architecture.md#✅ Service Scaffolding and Infrastructure]

### Current State Problem [Sources]

**Minimal Workflow Integration** - WorkflowService exists but underutilized
```csharp
public async Task<string> StartApprovalWorkflowAsync(Guid applicationId, ...)
{
    var processInstance = await _zeebeClient.NewCreateProcessInstanceCommand()
        .BpmnProcessId("loanOriginationProcess")
        .LatestVersion()
        .Variables(JsonSerializer.Serialize(new { applicationId = ... }))
        .WithResult()
        .Send(cancellationToken);
    
    return processInstance.ProcessInstanceKey.ToString();
}
```

**Problems**:
- Only starts processes, NO BPMN definition exists
- All other methods marked `[Obsolete]`
- No human task completion, no service task handlers
- No integration with approval authority matrix
[Source: brownfield-architecture.md#⚠️ Minimal Workflow Integration, lines 281-304]

**Target State**: Process-driven orchestration with Camunda BPMN
[Source: brownfield-architecture.md### Target State - Workflow-Driven Compliance Engine]

### BPMN Workflow Design [Sources]

**Process ID**: `loanOriginationProcess`
**Process Name**: Loan Origination Process

**Workflow Sequence** [Source: prd.md#Story 1.5, AC 1; prd.md#FR2]:
1. **Start Event** → Loan application initiated
2. **Service Task: KYC Gate** (`verify-kyc`) → Verify client KYC status
3. **User Task: Application Review** → Loan officer validates application data
4. **Service Task: Credit Assessment** (`request-credit-assessment`) → Trigger risk scoring
5. **Exclusive Gateway: Approval Routing** → Route based on amount + risk grade
6. **User Task: Approval** (multiple paths) → Credit Analyst / Head of Credit / CEO
7. **Service Task: Agreement Generation** (`generate-agreement`) → Generate loan agreement PDF
8. **User Task: Disbursement Authorization** → Finance officer authorizes disbursement
9. **Service Task: Execute Disbursement** (`execute-disbursement`) → Process payment
10. **End Event** → Loan active

### Approval Routing Logic [Sources]

**Exclusive Gateway Conditions** [Source: prd.md#Story 1.5, AC 2; prd.md#FR7]:

**Route 1: Credit Analyst** (Low risk, low amount)
- Condition: `loanAmount <= 50000 AND riskGrade in ('A', 'B')`
- Candidate Group: `credit-analysts`
- Single approval required

**Route 2: Head of Credit** (Medium risk or medium amount)
- Condition: `loanAmount > 50000 AND loanAmount <= 250000 OR riskGrade == 'C'`
- Candidate Group: `head-of-credit`
- Single approval required

**Route 3: Dual Control** (High risk or high amount)
- Condition: `loanAmount > 250000 OR riskGrade in ('D', 'F')`
- First Approval: Candidate Group `head-of-credit`
- Second Approval: Candidate Group `ceo`
- Sequential dual approval required (segregation of duties)

[Source: prd.md#FR7; brownfield-architecture.md#❌ 3. Dual Control Enforcement, lines 487-548]

### Human Tasks Definition [Sources]

**User Task 1: Application Review**
- **Task ID**: `applicationReview`
- **Name**: "Review Loan Application"
- **Candidate Groups**: `loan-officers`
- **Purpose**: Human validation of auto-populated client data before submission
- **Form**: Camunda Form with read-only fields for system-calculated values (EAR, DTI, monthly payment)
[Source: prd.md#FR13, FR14, FR17 - automation-first with human validation]

**User Task 2: Credit Analyst Approval**
- **Task ID**: `creditAnalystApproval`
- **Name**: "Credit Analyst Approval"
- **Candidate Groups**: `credit-analysts`
- **Assignee Exclusion**: Cannot be assigned to loan creator (handled in Story 1.7)
- **Form**: loan-approval-form.json (approve/reject with reason)
[Source: prd.md#Story 1.5, AC 3; brownfield-architecture.md#❌ 3. Dual Control Enforcement, lines 508-524]

**User Task 3: Head of Credit Approval**
- **Task ID**: `headOfCreditApproval`
- **Name**: "Head of Credit Approval"
- **Candidate Groups**: `head-of-credit`
- **Form**: loan-approval-form.json

**User Task 4: CEO Approval** (Dual Control)
- **Task ID**: `ceoApproval`
- **Name**: "CEO Approval (Second)"
- **Candidate Groups**: `ceo`
- **Form**: loan-approval-form.json
[Source: brownfield-architecture.md#❌ 3. Dual Control Enforcement, lines 535-546]

**User Task 5: Disbursement Authorization**
- **Task ID**: `disbursementAuthorization`
- **Name**: "Authorize Disbursement"
- **Candidate Groups**: `finance-officers`
- **Purpose**: Final authorization before payment execution
[Source: prd.md#Story 1.5, AC 3; brownfield-architecture.md### Target State, line 155]

### Service Tasks Definition [Sources]

**Service Task 1: KYC Verification**
- **Task ID**: `kycGate`
- **Job Type**: `verify-kyc`
- **Handler**: KycVerificationWorker (implemented in Story 1.6)
- **Purpose**: Verify client KYC status before proceeding
- **Error Handling**: Throws BPMN error `KYC_NOT_VERIFIED` if verification fails
[Source: prd.md#Story 1.5, AC 4; prd.md#FR1]

**Service Task 2: Credit Assessment**
- **Task ID**: `requestCreditAssessment`
- **Job Type**: `request-credit-assessment`
- **Handler**: CreditAssessmentWorker (implemented in Story 1.6)
- **Purpose**: Trigger external Credit Assessment Service for risk scoring
- **Fallback**: Manual credit review task if service unavailable
[Source: prd.md#Story 1.5, AC 4; prd.md#FR11]

**Service Task 3: Agreement Generation**
- **Task ID**: `generateAgreement`
- **Job Type**: `generate-agreement`
- **Handler**: GenerateAgreementWorker (implemented in Story 1.8)
- **Purpose**: Generate loan agreement PDF via JasperReports, store in MinIO
- **Timeout**: 10 seconds (throws incident if timeout)
[Source: prd.md#Story 1.5, AC 4; prd.md#FR8]

**Service Task 4: Execute Disbursement**
- **Task ID**: `executeDisbursement`
- **Job Type**: `execute-disbursement`
- **Handler**: DisbursementWorker (future story)
- **Purpose**: Execute payment via Tingg/PMEC integration
[Source: prd.md#Story 1.5, AC 4]

### BPMN Structure Requirements [Sources]

**Process Variables** (passed to workflow instance):
```json
{
  "applicationId": "guid",
  "clientId": "guid",
  "loanAmount": 50000.00,
  "riskGrade": "B",
  "productCode": "GEPL-001",
  "termMonths": 24,
  "createdBy": "userId",
  "loanNumber": "LUS-2025-00123"
}
```
[Source: prd.md#Story 1.5, AC 6]

**Required Zeebe Extension Elements**:
- `zeebe:taskDefinition` - Specifies job type for service tasks
- `zeebe:assignmentDefinition` - Specifies candidate groups for user tasks
- `zeebe:ioMapping` - Maps input/output variables
- `zeebe:formDefinition` - Links Camunda Forms for user tasks
[Source: brownfield-architecture.md#❌ 3. Dual Control Enforcement, lines 509-523]

**BPMN Validation Requirements** [Source: prd.md#Story 1.5, AC 7]:
- No validation errors in Camunda Modeler
- All sequence flows have source and target
- Exclusive gateway conditions properly formatted (FEEL expressions)
- All service tasks have job types defined
- All user tasks have candidate groups defined

### BpmnDeploymentService Implementation [Sources]

**Implementation Pattern**:
```csharp
public class BpmnDeploymentService : IHostedService
{
    private readonly IZeebeClient _zeebeClient;
    private readonly ILogger<BpmnDeploymentService> _logger;
    private readonly IConfiguration _configuration;
    
    public async Task StartAsync(CancellationToken cancellationToken)
    {
        try
        {
            // Read BPMN file from embedded resource or file system
            var bpmnPath = Path.Combine(AppContext.BaseDirectory, "Workflows", "loan-origination-process.bpmn");
            var bpmnContent = await File.ReadAllTextAsync(bpmnPath, cancellationToken);
            
            // Deploy to Zeebe
            var deployResponse = await _zeebeClient.NewDeployCommand()
                .AddResourceStringUtf8(bpmnContent, "loan-origination-process.bpmn")
                .Send(cancellationToken);
            
            var workflow = deployResponse.Workflows.FirstOrDefault();
            if (workflow != null)
            {
                _logger.LogInformation(
                    "Successfully deployed BPMN workflow. ProcessKey: {ProcessKey}, Version: {Version}",
                    workflow.WorkflowKey, workflow.Version);
            }
            else
            {
                throw new InvalidOperationException("BPMN deployment failed - no workflow returned");
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to deploy BPMN workflow on startup");
            throw; // Fail fast - service should not start without workflow
        }
    }
    
    public Task StopAsync(CancellationToken cancellationToken) => Task.CompletedTask;
}
```
[Source: prd.md#Story 1.5, AC 5 - IHostedService deployment pattern]

**Registration in Program.cs**:
```csharp
builder.Services.AddHostedService<BpmnDeploymentService>();
```

**Fail-Fast Strategy**: If BPMN deployment fails, service startup fails (prevent running without workflow)
[Source: prd.md#4.5 Risk Assessment - BPMN deployment failure risk mitigation]

### WorkflowService Enhancement [Sources]

**New Method: StartLoanOriginationWorkflowAsync**
```csharp
public async Task<string> StartLoanOriginationWorkflowAsync(
    Guid applicationId,
    Guid clientId,
    decimal loanAmount,
    string riskGrade,
    string productCode,
    int termMonths,
    string createdBy,
    string loanNumber,
    CancellationToken cancellationToken)
{
    var variables = new
    {
        applicationId = applicationId.ToString(),
        clientId = clientId.ToString(),
        loanAmount,
        riskGrade,
        productCode,
        termMonths,
        createdBy,
        loanNumber
    };
    
    var processInstance = await _zeebeClient.NewCreateProcessInstanceCommand()
        .BpmnProcessId("loanOriginationProcess")
        .LatestVersion()
        .Variables(JsonSerializer.Serialize(variables))
        .Send(cancellationToken);
    
    _logger.LogInformation(
        "Started loan origination workflow. ApplicationId: {ApplicationId}, WorkflowInstanceKey: {WorkflowInstanceKey}",
        applicationId, processInstance.ProcessInstanceKey);
    
    return processInstance.ProcessInstanceKey.ToString();
}
```
[Source: prd.md#Story 1.5, AC 6]

**Workflow State Tracking** [Source: prd.md#FR12]:
- Store `WorkflowInstanceKey` in LoanApplication.WorkflowInstanceId (field already exists)
- Expose workflow state via API for frontend query
- Track current task, workflow variables (future enhancement)

### File Locations [Sources]

- **New BPMN File**: `apps/IntelliFin.LoanOriginationService/Workflows/loan-origination-process.bpmn` [NEW]
- **New Service**: `apps/IntelliFin.LoanOriginationService/Services/BpmnDeploymentService.cs` [NEW]
- **Modify Service**: `apps/IntelliFin.LoanOriginationService/Services/WorkflowService.cs` [MODIFY]
- **Modify Controller**: `apps/IntelliFin.LoanOriginationService/Controllers/LoanApplicationController.cs` [MODIFY - future integration]
[Source: brownfield-architecture.md#4.3 Code Organization and Standards, prd.md#4.3]

### Technology Stack [Sources]

**Camunda 8 (Zeebe)**: Version 8.4+ [Source: prd.md#4.1 Existing Technology Stack]
- Zeebe Client SDK: Already configured in Program.cs
- BPMN 2.0 specification
- Zeebe FEEL expressions for gateway conditions

**Zeebe Client** (.NET SDK):
- Package: `Zeebe.Client` (already installed)
- IZeebeClient interface for workflow operations
- OAuth2 authentication to Zeebe Gateway (already configured)
[Source: brownfield-architecture.md#✅ Service Scaffolding, lines 207-213]

**Camunda Modeler**: Desktop application for BPMN design
- Version: 5.x+
- Download: https://camunda.com/download/modeler/
- Used for visual BPMN design and validation
[Source: prd.md#Story 1.5, AC 7]

### Coding Standards [Sources]

- **Async/await**: All Zeebe operations async with CancellationToken propagation [Source: brownfield-architecture.md#4.3 Coding Standards]
- **Structured logging**: Use Serilog with correlation IDs for workflow start, deployment, errors [Source: brownfield-architecture.md#4.3 Coding Standards]
- **Exception handling**: Infrastructure exceptions for Zeebe client failures [Source: brownfield-architecture.md#4.3 Coding Standards]
- **XML comments**: Required for all public interfaces and service classes [Source: brownfield-architecture.md#4.3 Documentation Standards]
- **Fail-fast**: Service startup must fail if BPMN deployment fails [Source: prd.md#4.5 Deployment Risks]

### Testing Requirements [Sources]

**Unit Tests (xUnit)**
- Test `BpmnDeploymentService.StartAsync` reads BPMN file from correct path [Source: prd.md#Story 1.5, AC 8]
- Test `BpmnDeploymentService` calls Zeebe deploy API with BPMN content [Source: prd.md#Story 1.5, AC 8]
- Test deployment failure throws exception (fail-fast behavior)
- Test `WorkflowService.StartLoanOriginationWorkflowAsync` creates process instance with correct variables [Source: prd.md#Story 1.5, AC 6]
- Mock `IZeebeClient` for unit tests

**Integration Tests**
- Deploy BPMN to real Zeebe instance (Testcontainers or dev environment) [Source: prd.md#Story 1.5, IV1]
- Start workflow instance and verify it appears in Camunda Operate [Source: prd.md#Story 1.5, IV2]
- Verify workflow variables correctly passed to Zeebe
- Test framework: xUnit with optional Testcontainers for Zeebe (if available)
[Source: prd.md#4.2 Testing Integration Strategy]

**BPMN Validation**
- Open loan-origination-process.bpmn in Camunda Modeler [Source: prd.md#Story 1.5, AC 7]
- Verify no validation errors (red error icons)
- Verify all paths are properly connected
- Export validated BPMN to Workflows folder

**Backward Compatibility Verification**
- Existing CRUD APIs continue working (workflow disabled via feature flag `EnableWorkflowOrchestration=false` initially) [Source: prd.md#Story 1.5, IV3; prd.md#4.4 Deployment Strategy]

### Performance Constraints [Sources]

- Workflow start must complete within 500ms p95 (excluding worker execution) [Source: prd.md#NFR1]
- System must handle 100 concurrent workflow instances without degradation [Source: prd.md#NFR3]
- BPMN deployment on startup must complete within 30 seconds [Source: prd.md#4.5 Deployment Risks]

### Feature Flag Strategy [Sources]

**Feature Flag**: `EnableWorkflowOrchestration` (appsettings.json or ConfigMap)
- **Default**: `false` (initial deployment - existing CRUD APIs continue working)
- **Activation**: Set to `true` after BPMN deployed and tested
- **Purpose**: Phased rollout, zero downtime deployment
[Source: prd.md#4.4 Deployment Strategy, lines 413-416]

**Implementation in LoanApplicationService**:
```csharp
if (_configuration.GetValue<bool>("EnableWorkflowOrchestration"))
{
    // Start Camunda workflow
    var workflowInstanceKey = await _workflowService.StartLoanOriginationWorkflowAsync(...);
    application.WorkflowInstanceId = workflowInstanceKey;
}
else
{
    // Existing CRUD logic (backward compatibility)
    await _loanApplicationService.ApproveApplicationAsync(...);
}
```

### Dependencies
- **Story 1.4**: KYC verification logic must exist for KYC Gate service task [Source: prd.md#Story 1.5 Dependencies]
- **Zeebe Infrastructure**: Camunda 8 Zeebe cluster operational [Source: prd.md#4.1 Critical Constraints]
- **Existing WorkflowService**: Zeebe client already configured [Source: brownfield-architecture.md#⚠️ Minimal Workflow Integration]

### Business Process Documentation References [Sources]

**Existing Domain Documents** (for BPMN design reference):
- `docs/domains/loan-origination/loan-application-workflow.md` - Current intake process
- `docs/domains/loan-origination/loan-approval-workflow.md` - Approval routing rules (dual control)
- `docs/domains/loan-origination/credit-assessment-process.md` - Risk grading methodology
- `docs/domains/loan-origination/loan-disbursement-process.md` - Disbursement workflow
[Source: brownfield-architecture.md### Domain Documentation, lines 64-72]

## Tasks / Subtasks

- [ ] Design BPMN workflow in Camunda Modeler (AC: 1, 2, 7)
  - [ ] Create new BPMN diagram: loan-origination-process.bpmn
  - [ ] Add Start Event "Loan Application Initiated" [Source: prd.md#Story 1.5, AC 1]
  - [ ] Add Service Task "KYC Gate" with job type `verify-kyc` [Source: prd.md#Story 1.5, AC 4]
  - [ ] Add User Task "Application Review" with candidate group `loan-officers`
  - [ ] Add Service Task "Credit Assessment" with job type `request-credit-assessment` [Source: prd.md#Story 1.5, AC 4]
  - [ ] Add Exclusive Gateway "Approval Routing" [Source: prd.md#Story 1.5, AC 2]
  - [ ] Add User Task "Credit Analyst Approval" with candidate group `credit-analysts` [Source: prd.md#Story 1.5, AC 3]
  - [ ] Add User Task "Head of Credit Approval" with candidate group `head-of-credit` [Source: prd.md#Story 1.5, AC 3]
  - [ ] Add User Task "CEO Approval" with candidate group `ceo` (dual control path) [Source: prd.md#Story 1.5, AC 3]
  - [ ] Add Service Task "Generate Agreement" with job type `generate-agreement` [Source: prd.md#Story 1.5, AC 4]
  - [ ] Add User Task "Disbursement Authorization" with candidate group `finance-officers` [Source: prd.md#Story 1.5, AC 3]
  - [ ] Add Service Task "Execute Disbursement" with job type `execute-disbursement` [Source: prd.md#Story 1.5, AC 4]
  - [ ] Add End Event "Loan Active"
  - [ ] Validate BPMN in Camunda Modeler (no validation errors) [Source: prd.md#Story 1.5, AC 7]

- [ ] Configure Exclusive Gateway conditions (AC: 2)
  - [ ] Add condition to "Credit Analyst" path: `loanAmount <= 50000 and riskGrade in ["A", "B"]` [Source: prd.md#Story 1.5, AC 2]
  - [ ] Add condition to "Head of Credit" path: `loanAmount > 50000 and loanAmount <= 250000 or riskGrade == "C"`
  - [ ] Add condition to "Dual Control" path: `loanAmount > 250000 or riskGrade in ["D", "F"]` [Source: prd.md#Story 1.5, AC 2]
  - [ ] Verify FEEL expression syntax in Camunda Modeler

- [ ] Add Zeebe extension elements to BPMN
  - [ ] Add `zeebe:taskDefinition` to all service tasks with correct job types
  - [ ] Add `zeebe:assignmentDefinition` to all user tasks with candidate groups
  - [ ] Add process variables definition in BPMN properties
  - [ ] Set BPMN process ID: `loanOriginationProcess`
  - [ ] Set BPMN process name: "Loan Origination Process"

- [ ] Save and export BPMN file
  - [ ] Create `apps/IntelliFin.LoanOriginationService/Workflows/` directory
  - [ ] Save BPMN file as `loan-origination-process.bpmn` in Workflows folder
  - [ ] Verify BPMN file is valid XML and readable

- [ ] Create BpmnDeploymentService (AC: 5)
  - [ ] Create `Services/BpmnDeploymentService.cs` implementing `IHostedService`
  - [ ] Inject `IZeebeClient`, `ILogger<BpmnDeploymentService>`, `IConfiguration`
  - [ ] Implement `StartAsync` to read BPMN file from Workflows folder [Source: prd.md#Story 1.5, AC 5]
  - [ ] Call `_zeebeClient.NewDeployCommand().AddResourceStringUtf8(...)` to deploy BPMN
  - [ ] Log successful deployment with ProcessKey and Version [Source: prd.md#Story 1.5, AC 5]
  - [ ] Throw exception on deployment failure (fail-fast) [Source: prd.md#4.5 Deployment Risks]
  - [ ] Implement `StopAsync` (no-op)
  - [ ] Add XML documentation comments

- [ ] Register BpmnDeploymentService in Program.cs (AC: 5)
  - [ ] Add `builder.Services.AddHostedService<BpmnDeploymentService>();`
  - [ ] Verify service starts on application startup
  - [ ] Verify deployment logs appear on startup

- [ ] Enhance WorkflowService (AC: 6)
  - [ ] Create or update `Services/IWorkflowService.cs` interface
  - [ ] Add method signature: `Task<string> StartLoanOriginationWorkflowAsync(Guid applicationId, Guid clientId, decimal loanAmount, string riskGrade, string productCode, int termMonths, string createdBy, string loanNumber, CancellationToken cancellationToken)` [Source: prd.md#Story 1.5, AC 6]
  - [ ] Implement method in `WorkflowService.cs`
  - [ ] Create process variables object with all required fields [Source: prd.md#Story 1.5, AC 6]
  - [ ] Call `_zeebeClient.NewCreateProcessInstanceCommand().BpmnProcessId("loanOriginationProcess").LatestVersion().Variables(...)`
  - [ ] Return `processInstance.ProcessInstanceKey.ToString()`
  - [ ] Add structured logging: workflow start, applicationId, workflowInstanceKey [Source: brownfield-architecture.md#4.3 Coding Standards]
  - [ ] Add XML documentation comments

- [ ] Add feature flag configuration
  - [ ] Add `"EnableWorkflowOrchestration": false` to appsettings.json (default disabled)
  - [ ] Document feature flag in appsettings.json comments
  - [ ] Plan LoanApplicationService integration (future story - not in this story scope)

- [ ] Write unit tests for BpmnDeploymentService (AC: 8)
  - [ ] Test `StartAsync` reads BPMN file from Workflows folder [Source: prd.md#Story 1.5, AC 8]
  - [ ] Test `StartAsync` calls `_zeebeClient.NewDeployCommand()` [Source: prd.md#Story 1.5, AC 8]
  - [ ] Test deployment failure throws exception (fail-fast)
  - [ ] Mock `IZeebeClient` to return deployment response
  - [ ] Mock file system to provide BPMN content

- [ ] Write unit tests for WorkflowService
  - [ ] Test `StartLoanOriginationWorkflowAsync` creates process instance with correct variables [Source: prd.md#Story 1.5, AC 6]
  - [ ] Test workflow variables JSON serialization
  - [ ] Test correlation ID propagation in logging
  - [ ] Mock `IZeebeClient` to return process instance key

- [ ] Write integration tests (IV1, IV2)
  - [ ] Test service startup with BPMN deployment [Source: prd.md#Story 1.5, IV1]
  - [ ] Verify startup logs show successful deployment with workflow key [Source: prd.md#Story 1.5, IV1]
  - [ ] Test `StartLoanOriginationWorkflowAsync` against real Zeebe instance (dev environment or Testcontainers)
  - [ ] Verify workflow instance appears in Camunda Operate [Source: prd.md#Story 1.5, IV2]
  - [ ] Verify workflow variables correctly set in Camunda Operate
  - [ ] Test deployment failure handling (invalid BPMN file)

- [ ] Integration verification: Backward compatibility (IV3)
  - [ ] Verify existing CRUD APIs continue working with feature flag disabled [Source: prd.md#Story 1.5, IV3]
  - [ ] Test loan creation without starting workflow (feature flag = false)
  - [ ] Test loan approval without workflow (feature flag = false)

- [ ] Documentation
  - [ ] Document BPMN workflow design decisions in README or docs/domains/loan-origination/
  - [ ] Document approval routing logic and conditions
  - [ ] Document feature flag usage and activation process
  - [ ] Document Camunda Modeler usage for BPMN updates

## Change Log

| Date       | Version | Description                      | Author |
|------------|---------|----------------------------------|--------|
| 2025-10-17 | 0.1     | Initial draft created            | SM     |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used

*(To be filled by dev agent)*

### Debug Log References

*(To be filled by dev agent)*

### Completion Notes

*(To be filled by dev agent)*

### File List

*(To be filled by dev agent)*

## QA Results

*(To be filled by QA agent)*
