# Story 1.1: Automated Monorepo Infrastructure Setup Scripts

## Status
Draft

## Story
**As a** system architect  
**I want** to create a set of automated setup scripts  
**So that** any developer can instantly and consistently scaffold the complete IntelliFin monorepo, solution, and project structure

## Acceptance Criteria
1. [ ] A version-controlled shell script (e.g., setup-solution.ps1) is created in the /tools/scripts directory
2. [ ] Executing this single script creates the IntelliFin.sln file and all required .NET projects (e.g., IntelliFin.ApiGateway, IntelliFin.Shared.DomainModels), organized into the correct solution folders
3. [ ] The script also scaffolds the apps/frontend Next.js application
4. [ ] The script initializes a docker-compose.yml file for our local development environment (SQL Server, RabbitMQ, Redis, MinIO, Vault)
5. [ ] After running the script, opening IntelliFin.sln in JetBrains Rider shows the complete, correct project structure, including a virtual docs folder
6. [ ] After running the script, the project builds successfully without errors
7. [ ] The setup script is idempotent (it can be run multiple times without causing errors)

## Detailed Implementation Steps

### Section 1: Project Foundation Setup
- [ ] Step 1: Create Nx Workspace Foundation
  - **Task**: Initialize Nx workspace with .NET 9.0 configuration and workspace-level package.json setup
  - **Files**: 
    - `nx.json`: Nx workspace configuration
    - `package.json`: Workspace dependencies and scripts
    - `workspace.json`: Project definitions and targets
    - `.nvmrc`: Node.js version specification
    - `tools/scripts/setup-solution.ps1`: Main setup script entry point
  - **Step Dependencies**: None (first step)
  - **User Instructions**: Run `nx init` to create workspace, configure .NET 9.0 support, and set up package.json with required dependencies

### Section 2: Solution and Project Structure
- [ ] Step 2: Create IntelliFin.sln and Core Projects
  - **Task**: Generate main solution file and create all microservice projects with proper namespaces and project references
  - **Files**:
    - `IntelliFin.sln`: Main solution file with project organization
    - `apps/IntelliFin.ApiGateway/IntelliFin.ApiGateway.csproj`: API Gateway project
    - `apps/IntelliFin.IdentityService/IntelliFin.IdentityService.csproj`: Identity service project
    - `apps/IntelliFin.ClientManagement/IntelliFin.ClientManagement.csproj`: Client management project
    - `apps/IntelliFin.LoanOrigination/IntelliFin.LoanOrigination.csproj`: Loan origination project
    - `apps/IntelliFin.CreditBureau/IntelliFin.CreditBureau.csproj`: Credit bureau project
    - `apps/IntelliFin.GeneralLedger/IntelliFin.GeneralLedger.csproj`: General ledger project
    - `apps/IntelliFin.PmecService/IntelliFin.PmecService.csproj`: PMEC service project
    - `apps/IntelliFin.Collections/IntelliFin.Collections.csproj`: Collections project
    - `apps/IntelliFin.Communications/IntelliFin.Communications.csproj`: Communications project
    - `apps/IntelliFin.Reporting/IntelliFin.Reporting.csproj`: Reporting project
    - `apps/IntelliFin.OfflineSync/IntelliFin.OfflineSync.csproj`: Offline sync project
  - **Step Dependencies**: Step 1 (Nx workspace)
  - **User Instructions**: Execute `dotnet new sln` and `dotnet new webapi` commands for each service, then add projects to solution with proper folder organization

### Section 3: Shared Libraries Creation
- [ ] Step 3: Create Shared Libraries and Domain Models
  - **Task**: Generate shared libraries for domain models, infrastructure, authentication, logging, validation, and UI components
  - **Files**:
    - `libs/IntelliFin.Shared.DomainModels/IntelliFin.Shared.DomainModels.csproj`: Domain models library
    - `libs/IntelliFin.Shared.Infrastructure/IntelliFin.Shared.Infrastructure.csproj`: Infrastructure library
    - `libs/IntelliFin.Shared.Authentication/IntelliFin.Shared.Authentication.csproj`: Authentication library
    - `libs/IntelliFin.Shared.Logging/IntelliFin.Shared.Logging.csproj`: Logging library
    - `libs/IntelliFin.Shared.Validation/IntelliFin.Shared.Validation.csproj`: Validation library
    - `libs/IntelliFin.Shared.UI/IntelliFin.Shared.UI.csproj`: UI components library
  - **Step Dependencies**: Step 2 (Solution structure)
  - **User Instructions**: Create class library projects for shared components, configure project references, and set up proper namespacing

### Section 4: Frontend Application Setup
- [ ] Step 4: Create Next.js Frontend Application
  - **Task**: Initialize Next.js 15+ application with TypeScript, Tailwind CSS, React Query, and Zustand configuration
  - **Files**:
    - `apps/IntelliFin.Frontend/package.json`: Frontend dependencies
    - `apps/IntelliFin.Frontend/next.config.js`: Next.js configuration
    - `apps/IntelliFin.Frontend/tailwind.config.js`: Tailwind CSS configuration
    - `apps/IntelliFin.Frontend/tsconfig.json`: TypeScript configuration
    - `apps/IntelliFin.Frontend/app/layout.tsx`: Root layout component
    - `apps/IntelliFin.Frontend/app/page.tsx`: Home page component
    - `apps/IntelliFin.Frontend/lib/query-client.ts`: React Query setup
    - `apps/IntelliFin.Frontend/lib/store.ts`: Zustand store setup
    - `apps/IntelliFin.Frontend/styles/globals.css`: Global styles with Tailwind
  - **Step Dependencies**: Step 1 (Nx workspace)
  - **User Instructions**: Run `npx create-next-app@latest` with TypeScript and Tailwind, then configure React Query and Zustand for state management

### Section 5: Testing Infrastructure
- [ ] Step 5: Create Testing Projects and Configuration
  - **Task**: Set up comprehensive testing infrastructure with unit, integration, and E2E test projects
  - **Files**:
    - `tests/IntelliFin.Tests.Unit/IntelliFin.Tests.Unit.csproj`: Unit test project
    - `tests/IntelliFin.Tests.Integration/IntelliFin.Tests.Integration.csproj`: Integration test project
    - `tests/IntelliFin.Tests.E2E/IntelliFin.Tests.E2E.csproj`: E2E test project
    - `apps/IntelliFin.Frontend/__tests__/setup.ts`: Frontend test setup
    - `apps/IntelliFin.Frontend/jest.config.js`: Jest configuration
    - `apps/IntelliFin.Frontend/playwright.config.ts`: Playwright E2E configuration
  - **Step Dependencies**: Steps 2-4 (All projects created)
  - **User Instructions**: Create test projects with xUnit for backend and Jest/Playwright for frontend, configure test runners and coverage

### Section 6: Docker Development Environment
- [ ] Step 6: Create Docker Compose Configuration
  - **Task**: Set up complete local development environment with all required services (SQL Server, RabbitMQ, Redis, MinIO, Vault)
  - **Files**:
    - `docker-compose.yml`: Main Docker Compose configuration
    - `docker-compose.override.yml`: Local development overrides
    - `tools/docker/sql-server/Dockerfile`: SQL Server custom configuration
    - `tools/docker/rabbitmq/rabbitmq.conf`: RabbitMQ configuration
    - `tools/docker/redis/redis.conf`: Redis configuration
    - `tools/docker/minio/minio.conf`: MinIO configuration
    - `tools/docker/vault/vault.hcl`: Vault configuration
    - `.env.example`: Environment variables template
  - **Step Dependencies**: Step 1 (Nx workspace)
  - **User Instructions**: Create Docker Compose file with all services, configure networking, volumes, and environment variables for local development

### Section 7: Build and Validation Scripts
- [ ] Step 7: Create Build and Validation Scripts
  - **Task**: Implement comprehensive build scripts, validation tools, and CI/CD preparation scripts
  - **Files**:
    - `tools/scripts/build-all.ps1`: Build all projects script
    - `tools/scripts/validate-setup.ps1`: Setup validation script
    - `tools/scripts/clean-solution.ps1`: Clean solution script
    - `tools/scripts/run-tests.ps1`: Test execution script
    - `tools/scripts/docker-dev.ps1`: Docker development script
    - `tools/scripts/check-dependencies.ps1`: Dependency validation script
    - `tools/scripts/setup-ide.ps1`: IDE configuration script
  - **Step Dependencies**: Steps 1-6 (Complete setup)
  - **User Instructions**: Create PowerShell scripts for common operations, validate all dependencies are installed, and ensure scripts are idempotent

### Section 8: Documentation and Configuration
- [ ] Step 8: Create Project Documentation and Configuration Files
  - **Task**: Generate comprehensive documentation, configuration files, and development guidelines
  - **Files**:
    - `README.md`: Project overview and setup instructions
    - `CONTRIBUTING.md`: Development guidelines
    - `docs/DEVELOPMENT.md`: Development environment setup
    - `docs/ARCHITECTURE.md`: System architecture overview
    - `.gitignore`: Git ignore rules
    - `.editorconfig`: Editor configuration
    - `global.json`: .NET SDK version specification
    - `Directory.Build.props`: Common MSBuild properties
    - `Directory.Packages.props`: Central package management
  - **Step Dependencies**: Steps 1-7 (Complete infrastructure)
  - **User Instructions**: Create comprehensive documentation, configure Git ignore rules, set up editor configuration, and establish development guidelines

### Section 9: Final Validation and Testing
- [ ] Step 9: Comprehensive Setup Validation
  - **Task**: Execute full validation suite to ensure all acceptance criteria are met and the setup is production-ready
  - **Files**:
    - `tools/scripts/validate-complete-setup.ps1`: Complete validation script
    - `tools/scripts/test-idempotency.ps1`: Idempotency testing script
    - `tools/scripts/validate-rider-integration.ps1`: JetBrains Rider validation
    - `tools/scripts/test-docker-environment.ps1`: Docker environment testing
    - `tools/scripts/performance-benchmark.ps1`: Performance validation
  - **Step Dependencies**: Steps 1-8 (Complete setup)
  - **User Instructions**: Run comprehensive validation tests, verify idempotency, test JetBrains Rider integration, validate Docker environment, and ensure all acceptance criteria are met

## IDE & Solution Structure (JetBrains Rider)

### Official IDE
The official IDE for the IntelliFin project is **JetBrains Rider**. The setup script must create a solution structure that is perfectly organized for Rider's project management capabilities.

### Target Solution Structure
The script will create the following solution structure that will be displayed in JetBrains Rider:

```
solution "IntelliFin" {
    // 📁 1. Documentation
    folder "docs" { 
        // Virtual folder linking to docs/ directory
    }

    // 📁 2. Applications
    folder "apps" {
        project "IntelliFin.ApiGateway"
        project "IntelliFin.IdentityService"
        project "IntelliFin.ClientManagement"
        project "IntelliFin.LoanOrigination"
        project "IntelliFin.CreditBureau"
        project "IntelliFin.GeneralLedger"
        project "IntelliFin.PmecService"
        project "IntelliFin.Collections"
        project "IntelliFin.Communications"
        project "IntelliFin.Reporting"
        project "IntelliFin.OfflineSync"
        project "IntelliFin.Frontend" // Next.js application
    }

    // 📁 3. Shared Libraries
    folder "libs" {
        project "IntelliFin.Shared.DomainModels"
        project "IntelliFin.Shared.Infrastructure"
        project "IntelliFin.Shared.Authentication"
        project "IntelliFin.Shared.Logging"
        project "IntelliFin.Shared.Validation"
        project "IntelliFin.Shared.UI"
    }

    // 📁 4. Testing
    folder "tests" {
        project "IntelliFin.Tests.Unit"
        project "IntelliFin.Tests.Integration"
        project "IntelliFin.Tests.E2E"
    }

    // 📁 5. Tooling
    folder "tools" {
        // Scripts and tooling projects
    }
}
```

### Solution Folder Benefits in Rider
- **Organized Navigation**: Clear separation of concerns in the solution explorer
- **Build Configuration**: Easy management of build dependencies and project references
- **Debugging**: Simplified debugging with organized project structure
- **Refactoring**: Enhanced refactoring capabilities across the organized structure

## Dev Notes

### Previous Story Insights
This is the first story in the project - no previous stories to reference.

### Script-Driven Infrastructure Philosophy
This story embodies our "Infrastructure as Code" philosophy from day one. Instead of manual setup processes that are error-prone and inconsistent, we create automated scripts that ensure:
- **Consistency**: Every developer gets the exact same setup
- **Reliability**: Eliminates human error in setup processes
- **Speed**: Instant project scaffolding for new team members
- **Maintainability**: Version-controlled setup processes that evolve with the project

### IntelliFin Branding and Naming Convention
All projects and namespaces will use the "IntelliFin" prefix:
- Solution file: `IntelliFin.sln`
- Project namespaces: `IntelliFin.{ServiceName}`
- Shared libraries: `IntelliFin.Shared.{LibraryName}`
- Test projects: `IntelliFin.Tests.{TestType}`

### Data Models
[Source: docs/architecture/system-architecture.md#core-data-models]
The setup script will create projects that support the following core data models:
- Client Management: Client, GovernmentEmployment, KycDocument, Address, Contact
- Loan Origination: LoanApplication, LoanProduct, CollateralAsset, UnderwritingNote, ApprovalStep
- Credit Assessment: CreditReport, CreditAssessment
- General Ledger: GLAccount, JournalEntry, PostingRule
- Collections: DeductionCycle, DeductionItem, Payment
- Communications: CommunicationsLog, NotificationTemplates, InAppNotifications, CommunicationRouting, CustomerCommunicationPreferences
- Audit: AuditEvent

### API Specifications
[Source: docs/architecture/system-architecture.md#api-architecture]
The script will scaffold projects that support:
- Internal APIs for all microservices
- External integration APIs (PMEC, TransUnion, Tingg, SMS Gateway)
- REST API design with OpenAPI 3.0 specification
- Future GraphQL support

### Component Specifications
[Source: docs/architecture/tech-stack.md]
The frontend scaffolding script will configure:
- Next.js 15+ with TypeScript 5.3+
- Tailwind CSS 3.4+ for styling
- Custom component library
- React Query 5.0+ for server state
- Zustand 4.4+ for client state

### Script-Generated File Structure
The setup script will create the following directory structure:
```
IntelliFin/
├── apps/
│   ├── IntelliFin.Frontend/      # Next.js application
│   ├── IntelliFin.ApiGateway/    # API Gateway with Ocelot
│   ├── IntelliFin.IdentityService/ # Identity microservice
│   ├── IntelliFin.ClientManagement/ # Client management microservice
│   ├── IntelliFin.LoanOrigination/ # Loan origination microservice
│   ├── IntelliFin.CreditBureau/  # Credit Bureau ACL (TransUnion)
│   ├── IntelliFin.GeneralLedger/ # General ledger microservice
│   ├── IntelliFin.PmecService/   # PMEC integration microservice
│   ├── IntelliFin.Collections/   # Collections microservice
│   ├── IntelliFin.Communications/ # Communications microservice
│   ├── IntelliFin.Reporting/     # Reporting microservice
│   └── IntelliFin.OfflineSync/   # Offline sync microservice
├── libs/
│   ├── IntelliFin.Shared.DomainModels/ # Shared domain models
│   ├── IntelliFin.Shared.Infrastructure/ # Shared infrastructure
│   ├── IntelliFin.Shared.Authentication/ # Shared auth components
│   ├── IntelliFin.Shared.Logging/ # Shared logging
│   ├── IntelliFin.Shared.Validation/ # Shared validation
│   └── IntelliFin.Shared.UI/     # Shared UI components
├── tests/
│   ├── IntelliFin.Tests.Unit/    # Unit tests
│   ├── IntelliFin.Tests.Integration/ # Integration tests
│   └── IntelliFin.Tests.E2E/     # End-to-end tests
├── tools/
│   ├── database/                 # Database scripts and migrations
│   ├── docker/                   # Docker configurations
│   └── scripts/                  # Build and deployment scripts
├── docs/                         # Documentation
├── IntelliFin.sln               # Main solution file
└── docker-compose.yml           # Local development environment
```

### Script Testing Requirements
The setup script must be thoroughly tested to ensure:
- **Idempotency**: Script can be run multiple times without errors
- **Clean State**: Script works from a completely clean directory
- **Dependency Validation**: Script validates required tools (dotnet, node, docker) are installed
- **Error Handling**: Script provides clear error messages and rollback capabilities
- **Cross-Platform**: Script works on Windows (PowerShell), macOS, and Linux

### Technical Constraints for Script-Generated Projects
[Source: docs/architecture/tech-stack.md]
The script will create projects with these constraints:
- .NET 9.0 for all backend services
- ASP.NET Core 9.0 with Minimal APIs
- SQL Server 2022 for primary database
- Redis 7.2+ for caching
- RabbitMQ 3.12+ for messaging
- Kubernetes 1.28+ for deployment
- All services must be containerized
- Follow Zambian data sovereignty requirements

### Script Dependencies
The setup script will require these tools to be pre-installed:
- .NET 9.0 SDK
- Node.js 18+ and npm/yarn
- Docker and Docker Compose
- Git (for version control)
- PowerShell (Windows) or Bash (macOS/Linux)

## Testing

### Script Testing Standards
The setup script must be tested with the following standards:
- **Test Framework**: PowerShell Pester for script testing, xUnit 3.0+ for generated projects
- **Test Location**: `tools/scripts/tests/` for script tests
- **Coverage Requirements**: 100% script execution paths covered
- **Test Types**: Unit tests for script functions, integration tests for full script execution
- **CI Integration**: Script tests must pass in CI/CD pipeline

### Script Test Scenarios
1. **Script Execution Validation**
   - Test script execution from clean directory
   - Test script idempotency (multiple runs)
   - Test script error handling and rollback
   - Test cross-platform compatibility
2. **Generated Structure Validation**
   - Verify IntelliFin.sln is created correctly
   - Validate all .NET projects are created with proper namespaces
   - Test Next.js application scaffolding
   - Verify docker-compose.yml configuration
3. **JetBrains Rider Integration**
   - Test solution opens correctly in Rider
   - Verify solution folder structure
   - Test project references and dependencies
   - Validate build success in Rider

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-01-XX | 1.0 | Initial story creation | Scrum Master |
| 2024-01-XX | 2.0 | Strategic shift to script-driven infrastructure setup | System Architect |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
